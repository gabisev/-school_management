{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}
    {% if object %}Modifier {{ object.get_nom_complet }}{% else %}Ajouter un parent{% endif %}
{% endblock %}

{% block page_title %}
    {% if object %}Modifier {{ object.get_nom_complet }}{% else %}Ajouter un parent{% endif %}
{% endblock %}

{% block page_actions %}
    <a href="{% url 'school_management:parent_list' %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-1"></i>Retour à la liste
    </a>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-user me-2"></i>
                    {% if object %}Modifier les informations{% else %}Informations du parent{% endif %}
                </h6>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- Informations de connexion -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                <i class="fas fa-key me-2"></i>Informations de connexion
                            </h6>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.first_name.id_for_label }}" class="form-label">
                                    {{ form.first_name.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                    <div class="text-danger small">{{ form.first_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.last_name.id_for_label }}" class="form-label">
                                    {{ form.last_name.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                    <div class="text-danger small">{{ form.last_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.username.id_for_label }}" class="form-label">
                                    {{ form.username.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.username }}
                                {% if form.username.errors %}
                                    <div class="text-danger small">{{ form.username.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.email.id_for_label }}" class="form-label">
                                    {{ form.email.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="text-danger small">{{ form.email.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Informations personnelles -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                <i class="fas fa-user me-2"></i>Informations personnelles
                            </h6>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.sexe.id_for_label }}" class="form-label">
                                    {{ form.sexe.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.sexe }}
                                {% if form.sexe.errors %}
                                    <div class="text-danger small">{{ form.sexe.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.relation.id_for_label }}" class="form-label">
                                    {{ form.relation.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.relation }}
                                {% if form.relation.errors %}
                                    <div class="text-danger small">{{ form.relation.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.date_naissance.id_for_label }}" class="form-label">
                                    {{ form.date_naissance.label }}
                                </label>
                                {{ form.date_naissance }}
                                {% if form.date_naissance.errors %}
                                    <div class="text-danger small">{{ form.date_naissance.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.lieu_naissance.id_for_label }}" class="form-label">
                                    {{ form.lieu_naissance.label }}
                                </label>
                                {{ form.lieu_naissance }}
                                {% if form.lieu_naissance.errors %}
                                    <div class="text-danger small">{{ form.lieu_naissance.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.nationalite.id_for_label }}" class="form-label">
                                    {{ form.nationalite.label }}
                                </label>
                                {{ form.nationalite }}
                                {% if form.nationalite.errors %}
                                    <div class="text-danger small">{{ form.nationalite.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.profession.id_for_label }}" class="form-label">
                                    {{ form.profession.label }}
                                </label>
                                {{ form.profession }}
                                {% if form.profession.errors %}
                                    <div class="text-danger small">{{ form.profession.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Informations de contact -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                <i class="fas fa-address-book me-2"></i>Informations de contact
                            </h6>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="{{ form.telephone.id_for_label }}" class="form-label">
                                    {{ form.telephone.label }}
                                </label>
                                {{ form.telephone }}
                                {% if form.telephone.errors %}
                                    <div class="text-danger small">{{ form.telephone.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="{{ form.adresse.id_for_label }}" class="form-label">
                                    {{ form.adresse.label }}
                                </label>
                                {{ form.adresse }}
                                {% if form.adresse.errors %}
                                    <div class="text-danger small">{{ form.adresse.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sélection des enfants -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                <i class="fas fa-child me-2"></i>Enfants
                            </h6>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label for="{{ form.enfants.id_for_label }}" class="form-label">
                                    {{ form.enfants.label }}
                                </label>
                                <div class="border rounded p-3" style="max-height: 300px; overflow-y: auto;">
                                    {% for choice in form.enfants %}
                                        <div class="form-check">
                                            {{ choice.tag }}
                                            <label class="form-check-label" for="{{ choice.id_for_label }}">
                                                {{ choice.choice_label }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>
                                {% if form.enfants.help_text %}
                                    <small class="form-text text-muted">{{ form.enfants.help_text }}</small>
                                {% endif %}
                                {% if form.enfants.errors %}
                                    <div class="text-danger small">{{ form.enfants.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Photo -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                <i class="fas fa-camera me-2"></i>Photo
                            </h6>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="{{ form.photo.id_for_label }}" class="form-label">
                                    {{ form.photo.label }}
                                </label>
                                {{ form.photo }}
                                {% if form.photo.errors %}
                                    <div class="text-danger small">{{ form.photo.errors.0 }}</div>
                                {% endif %}
                                {% if object and object.photo %}
                                    <div class="mt-2">
                                        <small class="text-muted">Photo actuelle :</small><br>
                                        <img src="{{ object.photo.url }}" alt="{{ object.get_nom_complet }}" 
                                             class="rounded" width="100" height="100">
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-end">
                        <a href="{% url 'school_management:parent_list' %}" class="btn btn-secondary me-2">
                            <i class="fas fa-times me-1"></i>Annuler
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>
                            {% if object %}Mettre à jour{% else %}Créer{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Aide -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>Informations
                </h6>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6><i class="fas fa-lightbulb me-2"></i>Conseils</h6>
                    <ul class="mb-0">
                        <li>Le nom d'utilisateur doit être unique</li>
                        <li>L'email sera utilisé pour les communications</li>
                        <li>Le téléphone est important pour les urgences</li>
                        <li>La relation détermine le rôle du parent</li>
                    </ul>
                </div>
                
                <div class="alert alert-warning">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Important</h6>
                    <p class="mb-0">
                        Un compte utilisateur sera créé automatiquement avec le mot de passe défini sur le numéro du premier enfant sélectionné.
                        Si aucun enfant n'est sélectionné, le mot de passe par défaut sera "parent123".
                    </p>
                </div>
                
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle me-2"></i>Mot de passe automatique</h6>
                    <p class="mb-0">
                        Le mot de passe sera automatiquement défini sur le numéro étudiant du premier enfant sélectionné.
                        Le parent pourra se connecter avec son nom d'utilisateur et ce mot de passe.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
